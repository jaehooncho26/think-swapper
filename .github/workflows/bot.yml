name: GalaDEX Bot

on:
  schedule:
    - cron: "*/10 * * * *"   # every 10 minutes
  workflow_dispatch: {}

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 12
    concurrency:
      group: galadex-bot
      cancel-in-progress: true

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Install exactly what's in package-lock.json; fallback to npm install if lockfile missing
      - name: Install deps (locked)
        run: npm ci || npm install

      - name: Run bot once
        env:
          # Secrets (must be set in repo → Settings → Secrets and variables → Actions)
          WALLET_ADDRESS: ${{ secrets.WALLET_ADDRESS }}   # include the "eth|" prefix
          PRIVATE_KEY:    ${{ secrets.PRIVATE_KEY }}      # 0x... key

          # Runtime settings
          DRY_RUN:        "false"       # set "true" to simulate without sending
          BOT_USD_CENTS:  "100"         # $1 per tick
          SLIPPAGE_BPS:   "200"         # 2.0% (testing cushion)
          MIN_PROFIT_BPS: "10"          # 0.10%
          TX_WAIT_MS:     "120000"      # 2-minute confirmation wait

          # Optional: pin production endpoints (usually not needed)
          # GATEWAY_BASE_URL:     ${{ secrets.GATEWAY_BASE_URL }}
          # BUNDLER_BASE_URL:     ${{ secrets.BUNDLER_BASE_URL }}
          # DEX_BACKEND_BASE_URL: ${{ secrets.DEX_BACKEND_BASE_URL }}

          # Optional: extra logs for one run
          # DEBUG: "true"
        run: npm run once
