name: GalaDEX Bot

on:
  schedule:
    - cron: "*/15 * * * *"   # every 15 minutes
  workflow_dispatch: {}

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    concurrency:
      group: galadex-bot
      cancel-in-progress: true

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Install exactly what's in package-lock.json (deterministic)
      - name: Install deps (locked)
        run: npm ci

      - name: Run bot once
        env:
          # Secrets (must be set in repo → Settings → Secrets and variables → Actions)
          WALLET_ADDRESS: ${{ secrets.WALLET_ADDRESS }}   # include the "eth|" prefix
          PRIVATE_KEY:    ${{ secrets.PRIVATE_KEY }}      # 0x... key

          # Safe defaults (tweak as needed)
          DRY_RUN:        "false"       # flip to "false" after testing
          BOT_USD_CENTS:  "100"        # $1 each tick
          SLIPPAGE_BPS:   "150"         # 1.5%
          MIN_PROFIT_BPS: "10"         # 0.10%

          # Optional: uncomment & set if you need to pin prod endpoints
          # GATEWAY_BASE_URL:     ${{ secrets.GATEWAY_BASE_URL }}
          # BUNDLER_BASE_URL:     ${{ secrets.BUNDLER_BASE_URL }}
          # DEX_BACKEND_BASE_URL: ${{ secrets.DEX_BACKEND_BASE_URL }}

          # Optional: SDK verbose logs while debugging
          # DEBUG: "true"
        run: npm run once
