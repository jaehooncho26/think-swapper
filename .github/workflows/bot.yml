name: GalaDEX Bot

on:
  schedule:
    - cron: "*/10 * * * *"   # every 10 minutes
  workflow_dispatch: {}

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 12
    concurrency:
      group: galadex-bot
      cancel-in-progress: true

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install deps (locked)
        run: npm ci || npm install

      - name: Run bot once
        env:
          # REQUIRED: wallet & key
          WALLET_ADDRESS: ${{ secrets.WALLET_ADDRESS }}   # must include "eth|" prefix
          PRIVATE_KEY:    ${{ secrets.PRIVATE_KEY }}

          # Runtime
          DRY_RUN:        "false"       # real swap
          BOT_USD_CENTS:  "100"         # $5 for clear balance delta on first real test
          SLIPPAGE_BPS:   "100"         # 2.0% cushion while testing
          MIN_PROFIT_BPS: "10"          # sell filter, irrelevant for buy leg
          TX_WAIT_MS:     "120000"      # 2-minute wait window

          # Gas reserve (new)
          GAS_MIN_GALA:        "1500"   # keep at least 1,500 GALA at all times
          GAS_TOPUP_USD_CENTS: "5000"   # when under 1,500, buy ~$50 of GALA to refill

          # Pin PRODUCTION endpoints explicitly
          GATEWAY_BASE_URL:      "https://gateway-mainnet.galachain.com"
          BUNDLER_BASE_URL:      "https://bundle-backend-prod1.defi.gala.com"
          DEX_BACKEND_BASE_URL:  "https://dex-backend-prod1.defi.gala.com"

          # One-time verbose logs; turn off after success
          DEBUG: "false"
        run: npm run once
